const T={speed:.3,direction:"left",draggable:!0,snap:!1};let S;function q(){const r=window.gsap,n=window.Draggable;if(!r||!n){console.warn("GSAP atau Draggable belum termuat.");return}r.registerPlugin(n);const t=document.querySelector(".cc-slider"),s=document.querySelector(".cc-slider-wrapper");let e=Array.from(document.querySelectorAll(".cc-slider-item"));if(!t||!s||e.length===0)return;M(e);const a=window.innerWidth,u=e[0].getBoundingClientRect().width,c=parseFloat(window.getComputedStyle(e[0]).marginRight)||0,l=u+c,m=a*3+l*4;let p=l*e.length;for(;p<m;)e.forEach(i=>{const w=i.cloneNode(!0);t.appendChild(w)}),p+=l*e.length;if(t.offsetHeight,"ontouchstart"in window||navigator.maxTouchPoints>0){const i=document.querySelector(".cc-cursor");i&&(i.style.display="none"),s&&s.classList.remove("has-custom-cursor")}else{s.classList.add("has-custom-cursor");const i=document.querySelector(".cc-cursor"),w=r.quickTo(i,"x",{duration:.3,ease:"power3"}),y=r.quickTo(i,"y",{duration:.3,ease:"power3"});window.addEventListener("mousemove",f=>{w(f.clientX-40),y(f.clientY-40)}),s.addEventListener("mouseenter",()=>r.to(i,{scale:1,opacity:1})),s.addEventListener("mouseleave",()=>r.to(i,{scale:0,opacity:0})),s.addEventListener("mousedown",()=>r.to(i,{scale:.8})),s.addEventListener("mouseup",()=>r.to(i,{scale:1}))}const b=r.utils.toArray(".cc-slider-item");S=A(b,{speed:T.speed,repeat:-1,paddingRight:30,draggable:T.draggable,reversed:T.direction==="right",snap:T.snap,wrapper:s})}function M(r){r.forEach(n=>{const t=n.querySelector(".card");if(!t)return;const s=t.getAttribute("style");if(s&&s.includes("--card-bg"))return;const e=t.querySelector("img");e&&(e.complete?E(e,t):e.onload=()=>E(e,t))})}function E(r,n){try{const t=document.createElement("canvas"),s=t.getContext("2d");if(!s)return;t.width=50,t.height=50,s.drawImage(r,0,0,50,50);const e=s.getImageData(0,0,50,50).data;let a=0,u=0,c=0,l=0;for(let g=0;g<e.length;g+=4)a+=e[g],u+=e[g+1],c+=e[g+2],l++;a=Math.floor(a/l),u=Math.floor(u/l),c=Math.floor(c/l);const m=.4;a=Math.floor(a*m),u=Math.floor(u*m),c=Math.floor(c*m),a<20&&u<20&&c<20&&(a+=15,u+=15,c+=15);const p=`rgb(${a}, ${u}, ${c})`;n.style.setProperty("--card-bg",p)}catch(t){console.warn("Cannot extract color from image (CORS likely):",t)}}document.addEventListener("DOMContentLoaded",()=>{setTimeout(q,100);let r,n=window.innerWidth;window.addEventListener("resize",()=>{const t=window.innerWidth;t!==n&&(n=t,clearTimeout(r),r=setTimeout(()=>{S&&S.kill(),window.location.reload()},200))})});function A(r,n){const t=window.gsap,s=window.Draggable;r=t.utils.toArray(r),n=n||{};let e=t.timeline({repeat:n.repeat,defaults:{ease:"none"},onReverseComplete:()=>e.totalTime(e.rawTime()+e.duration()*100)}),a=r.length,u=r[0].offsetLeft,c=[],l=[],m=[],p=0,g=(n.speed||1)*100,b=n.snap===!1?o=>o:t.utils.snap(n.snap||1),i,w,y,f,P,h;for(t.set(r,{xPercent:(o,d)=>{let x=l[o]=parseFloat(t.getProperty(d,"width","px"));return m[o]=b(parseFloat(t.getProperty(d,"x","px"))/x*100+t.getProperty(d,"xPercent")),m[o]}}),t.set(r,{x:0}),i=r[a-1].offsetLeft+m[a-1]/100*l[a-1]-u+r[a-1].offsetWidth*t.getProperty(r[a-1],"scaleX")+(parseFloat(n.paddingRight)||0),h=0;h<a;h++)P=r[h],w=m[h]/100*l[h],y=P.offsetLeft+w-u,f=y+l[h]*t.getProperty(P,"scaleX"),e.to(P,{xPercent:b((w-f)/l[h]*100),duration:f/g},0).fromTo(P,{xPercent:b((w-f+i)/l[h]*100)},{xPercent:m[h],duration:(w-f+i-w)/g,immediateRender:!1},f/g).add("label"+h,y/g),c[h]=y/g;function C(o,d){d=d||{},Math.abs(o-p)>a/2&&(o+=o>p?-a:a);let x=t.utils.wrap(0,a,o),v=c[x];return v>e.time()!=o>p&&(d.modifiers={time:t.utils.wrap(0,e.duration())},v+=e.duration()*(o>p?1:-1)),p=x,d.overwrite=!0,e.tweenTo(v,d)}if(e.next=o=>C(p+1,o),e.previous=o=>C(p-1,o),e.current=()=>p,e.toIndex=(o,d)=>C(o,d),e.times=c,e.progress(1,!0).progress(0,!0),n.reversed&&(e.vars.onReverseComplete(),e.reverse()),n.draggable&&s){let o=document.createElement("div");const d=n.wrapper||document.body;d.appendChild(o),t.set(o,{position:"absolute",top:0,left:0,width:0,height:0,display:"none"});let x=t.utils.wrap(0,1),v,L;s.create(o,{trigger:d,type:"x",onPress(){v=e.progress(),e.pause(),L=this.x},onDrag(){let W=this.x-L,R=x(v+-W/i);e.progress(R)},onRelease(){n.reversed?t.to(e,{timeScale:-1,duration:.5,onComplete:()=>e.reverse()}):t.to(e,{timeScale:1,duration:.5,onComplete:()=>e.play()})}})[0]}return e}
